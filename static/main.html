<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Main page</title>
    <style>
      body {
        text-align: center;
        font-size: 33px;
      }
    </style>
    <script type="text/javascript">
	var localData = [];
	function updateData(){
		fetch('getAllData')
		  .then(response =>{ return response.json();
		})
		  .then(data=> {			   
			   var strData = JSON.stringify(data);
				   if ( strData !== localData){				   
					var tbl = document.getElementById("table");
					var old = document.getElementById("tbody");
					if (old){tbl.removeChild(old);}
					//console.log("update by new data=" + strData);					   
					var tbdy = document.createElement('tbody');
					tbdy.setAttribute("id", "tbody");
					data.map(raw =>{
						var tr = tbl.insertRow();
						Object.keys(raw).map(cell=>{
						if (cell!="data"  ){// && cell!="ip" 
							var td = tr.insertCell();
							if (raw[cell]!=null ){
								td.appendChild(document.createTextNode(raw[cell]));
							}}
						})
					tbdy.appendChild(tr);
				   })			  
				  tbl.appendChild(tbdy);
				  localData = strData;
			  }
			  })
		  .catch( e => {
			console.log("fetch went wrong" );
		})
	}	
	window.onload = updateData;	
	var x = setInterval(function() {
		console.log("check for update data");
		updateData();
		}, 2000);
    
    </script>
  </head>
  <body>
    <h1>Color Server Main page</h1>
	<h2>Last data from devices <img src="images/smiley.gif" alt="Smiley face" height="42" width="42"></h2>
	<div style="display: flex; justify-content: center;">
		<table id="table" style="width:60%;" border= "1px">
			<thead><tr>
				<th>ID</th>
				<th>User</th>
				<th>Date</th>
				<th>IP</th>
			</tr></thead>
		</table>
	</div>
	<div id="timer"></div>
	</body>
</html>